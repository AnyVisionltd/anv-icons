"use strict";

exports.__esModule = true;
exports.default = void 0;

var _util = require("./util");

/* eslint-disable no-underscore-dangle */
async function output(promise) {
  process.stdout.write(`${await promise}\n`);
}

async function fileCommand(program, filenames, config) {
  function stdin() {
    let code = '';
    process.stdin.setEncoding('utf8');
    process.stdin.on('readable', () => {
      const chunk = process.stdin.read();
      if (chunk !== null) code += chunk;
    });
    process.stdin.on('end', () => {
      output((0, _util.convert)(code, config, {
        filePath: program.stdinFilepath
      }));
    });
  }

  if (program.stdin || filenames.length === 0 && !process.stdin.isTTY) {
    stdin();
    return;
  }

  if (filenames.length === 0) {
    // eslint-disable-next-line no-console
    console.log(program.helpInformation());
    return;
  }

  if (filenames.length > 1) {
    (0, _util.exitError)('Please specify only one filename or use `--out-dir` option.');
    return;
  }

  const [filename] = filenames;
  const stats = await (0, _util.stat)(filename);

  if (stats.isDirectory()) {
    (0, _util.exitError)('Directory are not supported without `--out-dir` option instead.');
  }

  output((0, _util.convertFile)(filename, config));
}

var _default = fileCommand;
exports.default = _default;